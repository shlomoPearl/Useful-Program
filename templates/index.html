<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bill Parser</title>

    <!-- Tailwind CSS (CDN, zero config) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Tooltip styling override */
        .tooltiptext {
            @apply invisible opacity-0 absolute bg-gray-800 text-white text-sm rounded-lg p-3 transition-opacity duration-300 w-64;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
        }
        .tooltip:hover .tooltiptext {
            @apply visible opacity-100;
        }
    </style>
</head>

<!-- Modern Fullscreen Loader -->
<div id="loading-overlay"
     style="
        position: fixed;
        inset: 0;
        background: rgba(255,255,255,0.6);
        backdrop-filter: blur(6px);
        display: none;
        z-index: 9999;
        justify-content: center;
        align-items: center;
        transition: opacity 0.3s ease;
     ">
    <div style="
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    ">
        <div class="loader"></div>
        <div style="font-size: 1.2rem; color:#333; font-weight:500;">
            Preparing your graph...
        </div>
    </div>
</div>

<style>
/* Modern animated loader ring */
.loader {
    width: 70px;
    height: 70px;
    border: 6px solid #ddd;
    border-top-color: #4a00e0;
    border-radius: 50%;
    animation: spin 0.9s linear infinite, pulse 1.8s ease-in-out infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Subtle pulse glow */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(74,0,224,0.2); }
    50% { box-shadow: 0 0 20px 8px rgba(74,0,224,0.15); }
    100% { box-shadow: 0 0 0 0 rgba(74,0,224,0.2); }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");
    if (form) {
        form.addEventListener("submit", function () {
            const overlay = document.getElementById("loading-overlay");
            overlay.style.display = "flex";
            overlay.style.opacity = "1";
        });
    }
});
</script>


<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-xl border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
            Bill Parser
        </h2>

        <form method="post" enctype="multipart/form-data" class="space-y-5">

            <!-- Email -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="email">Sender Email Address</label>
                <input type="email" id="email" name="email" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
            </div>

            <!-- Subject -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="subject">
                    Subject (optional)

                    <span class="tooltip text-blue-600 cursor-pointer ml-1">❓
                        <span class="tooltiptext">
                            Filter emails by subject (e.g. "Water Bill") if the sender sends multiple invoice types.
                        </span>
                    </span>
                </label>

                <input type="text" id="subject" name="subject" placeholder="e.g., Electricity Invoice"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
            </div>

            <!-- Keyword -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="keyword">
                    Keyword (optional)

                    <span class="tooltip text-blue-600 cursor-pointer ml-1">❓
                        <span class="tooltiptext">
                            Filter invoice content by keyword (e.g. "Maintenance") if invoices contain several services.
                        </span>
                    </span>
                </label>

                <input type="text" id="keyword" name="keyword" placeholder="e.g., Water"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
            </div>

            <!-- Currency -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="currency">Currency Symbol</label>
                <select id="currency" name="currency" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-400">
                    <option value="₪">₪ - Israeli Shekel</option>
                    <option value="$">$ - US Dollar</option>
                    <option value="€">€ - Euro</option>
                    <option value="£">£ - British Pound</option>
                    <option value="₹">₹ - Indian Rupee</option>
                    <option value="¥">¥ - Japanese Yen</option>
                    <option value="₩">₩ - South Korean Won</option>
                </select>
            </div>

            <!-- Start Date -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="start_date">Start Date</label>
                <input type="text" id="start_date" name="start_date" required placeholder="dd/mm/yyyy"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400">
                <div id="start_error" class="text-red-500 text-sm"></div>
            </div>

            <!-- End Date -->
            <div>
                <label class="block font-medium text-gray-700 mb-1" for="end_date">End Date</label>
                <input type="text" id="end_date" name="end_date" required placeholder="dd/mm/yyyy"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400">
                <div id="end_error" class="text-red-500 text-sm"></div>
            </div>

            <!-- Submit Button -->
            <button type="submit"
                    class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl shadow hover:bg-blue-700 transition">
                Parse Bills
            </button>
        </form>
    </div>

<script>
/* Your original date-formatting JS stays exactly the same */
function isValidDateFormat(val) {
  const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
  const match = val.match(regex);
  if (!match) return false;

  const [_, dd, mm, yyyy] = match.map(Number);
  const date = new Date(yyyy, mm - 1, dd);
  return (
    date.getFullYear() === yyyy &&
    date.getMonth() === mm - 1 &&
    date.getDate() === dd
  );
}

function formatDateInput(input, errorElementId) {
  let key = input.dataset.lastKey;
  let val = input.value.replace(/\D/g, "");

  if (key === "Backspace") {
    input.dataset.lastKey = "";
    return;
  }

  if (val.length >= 3 && val.length <= 4) {
    val = val.slice(0, 2) + "/" + val.slice(2);
  } else if (val.length > 4) {
    val = val.slice(0, 2) + "/" + val.slice(2, 2 + 2) + "/" + val.slice(4, 8);
  }

  input.value = val;

  const errorElem = document.getElementById(errorElementId);
  if (val.length === 10 && !isValidDateFormat(val)) {
    errorElem.textContent = "⚠ Invalid date";
  } else {
    errorElem.textContent = "";
  }
}

document.addEventListener("DOMContentLoaded", function () {
  const startInput = document.getElementById("start_date");
  const endInput = document.getElementById("end_date");

  [startInput, endInput].forEach(input => {
    input.addEventListener("keydown", e => {
      input.dataset.lastKey = e.key;
    });
    input.addEventListener("input", () => {
      formatDateInput(input, input.id === "start_date" ? "start_error" : "end_error");
    });

    input.setAttribute("type", "text");
    input.setAttribute("pattern", "\\d{2}/\\d{2}/\\d{4}");
  });
});
</script>

</body>
</html>
